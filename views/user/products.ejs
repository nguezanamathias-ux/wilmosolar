<%- include('../partials/header') %>

<div class="container">
    <h1 class="page-title">
        <img src="/images/icons/products.svg" alt="Produits" class="title-icon">
        Nos Produits Solaires
    </h1>

    <div class="page-intro">
        <h3>Des machines pensees pour la performance</h3>
        <p>Chaque kit represente un niveau d'investissement adapte a votre objectif. Les machines premium offrent un rendement journalier plus eleve et une meilleure acceleration de portefeuille.</p>
    </div>

    <div class="product-advice">
        <div class="advice-card"><div class="advice-title">Petit</div><div class="advice-text">Commencez avec un kit accessible.</div></div>
        <div class="advice-card"><div class="advice-title">Moyen</div><div class="advice-text">Renforcez votre portefeuille.</div></div>
        <div class="advice-card"><div class="advice-title">Grand</div><div class="advice-text">Maximisez vos gains.</div></div>
    </div>

    <div class="products-grid">
        <% products.forEach(product => { %>
            <% const totalReturn = product.daily_earnings * product.duration_days; %>
            <% const roi = product.price > 0 ? Math.round((totalReturn / product.price) * 100) : 0; %>
            <div class="product-card">
                <div class="product-image">
                    <% if (product.image_url) { %>
                        <img src="<%= product.image_url %>" alt="<%= product.name %>">
                    <% } else { %>
                        <img src="/images/logo.png" alt="Produit" class="product-fallback-icon">
                    <% } %>
                    <% if (roi >= 900) { %>
                        <span class="product-badge best">Meilleur ROI</span>
                    <% } else if (product.price >= 50000) { %>
                        <span class="product-badge popular">Populaire</span>
                    <% } %>
                </div>
                <div class="product-info">
                    <div class="product-price"><%= product.price.toLocaleString() %> FCFA</div>
                    <div class="product-return"><img src="/images/icons/income.svg" alt="" class="label-icon"> <%= product.daily_earnings.toLocaleString() %> FCFA/jour</div>
                    <div class="product-total">Total sur <%= product.duration_days %> jours: <strong><%= totalReturn.toLocaleString() %> FCFA</strong></div>
                    <div class="product-description"><%= product.description %></div>
                    <div class="product-actions">
                        <a class="btn btn-secondary" href="/user/products/<%= product.id %>">Details</a>
                        <% if (userBalance >= product.price) { %>
                            <form action="/user/products/buy/<%= product.id %>" method="POST">
                                <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                                <button type="submit" class="btn btn-buy">Acheter</button>
                            </form>
                        <% } else { %>
                            <button class="btn btn-buy" disabled>Solde insuffisant</button>
                        <% } %>
                    </div>
                </div>
            </div>
        <% }) %>
    </div>
</div>

<%- include('../partials/bottom-nav') %>
<%- include('../partials/footer') %>
